
# TestRaceConditionBookNoAtomicNoLock
```log
Current page: 0
==================
WARNING: DATA RACE
Write at 0x00c00011c640 by goroutine 8:
  github.com/tlylt/learn-go/book.(*Book).TurnPage()
      /Users/yong/Documents/GitHub/learn-go/book/book.go:37 +0x98
  github.com/tlylt/learn-go/book.TestRaceConditionBookNoAtomicNoLock.func1()
      /Users/yong/Documents/GitHub/learn-go/book/book_test.go:26 +0x80

Previous read at 0x00c00011c640 by goroutine 7:
  github.com/tlylt/learn-go/book.(*Book).OnPage()
      /Users/yong/Documents/GitHub/learn-go/book/book.go:21 +0x17c
  github.com/tlylt/learn-go/book.TestRaceConditionBookNoAtomicNoLock()
      /Users/yong/Documents/GitHub/learn-go/book/book_test.go:29 +0x188
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1792 +0x180
  testing.(*T).Run.gowrap1()
      /usr/local/go/src/testing/testing.go:1851 +0x40

Goroutine 8 (running) created at:
  github.com/tlylt/learn-go/book.TestRaceConditionBookNoAtomicNoLock()
      /Users/yong/Documents/GitHub/learn-go/book/book_test.go:24 +0x16c
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1792 +0x180
  testing.(*T).Run.gowrap1()
      /usr/local/go/src/testing/testing.go:1851 +0x40

Goroutine 7 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1851 +0x684
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:2279 +0x7c
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1792 +0x180
  testing.runTests()
      /usr/local/go/src/testing/testing.go:2277 +0x77c
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:2142 +0xb68
  main.main()
      _testmain.go:55 +0x110
==================
--- FAIL: TestRaceConditionBookNoAtomicNoLock (0.00s)
    book_test.go:33: Expected page to be 2, Actual page is  1
    testing.go:1490: race detected during execution of test
FAIL
exit status 1
FAIL    github.com/tlylt/learn-go/book  0.284s
```

# 

## Result 1
```log
After SkipFirstPage: page: 2
==================
WARNING: DATA RACE
Write at 0x00c00011c6a0 by goroutine 8:
  ??()
      -:0 +0x1006eaee8
  sync/atomic.AddInt32()
      <autogenerated>:1 +0x14
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1792 +0x180
  testing.(*T).Run.gowrap1()
      /usr/local/go/src/testing/testing.go:1851 +0x40

Previous read at 0x00c00011c6a0 by goroutine 9:
  github.com/tlylt/learn-go/book.(*Book).SkipFirstPage()
      /Users/yong/Documents/GitHub/learn-go/book/book.go:53 +0x88
  github.com/tlylt/learn-go/book.TestRaceConditionBookWithAtomic.func1()
      /Users/yong/Documents/GitHub/learn-go/book/book_test.go:47 +0x84

Goroutine 8 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1851 +0x684
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:2279 +0x7c
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1792 +0x180
  testing.runTests()
      /usr/local/go/src/testing/testing.go:2277 +0x77c
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:2142 +0xb68
  main.main()
      _testmain.go:51 +0x110

Goroutine 9 (finished) created at:
  github.com/tlylt/learn-go/book.TestRaceConditionBookWithAtomic()
      /Users/yong/Documents/GitHub/learn-go/book/book_test.go:45 +0x168
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1792 +0x180
  testing.(*T).Run.gowrap1()
      /usr/local/go/src/testing/testing.go:1851 +0x40
==================
After TurnPageAtomic: page: 3
3
End of test: page: 3
--- FAIL: TestRaceConditionBookWithAtomic (0.00s)
    testing.go:1490: race detected during execution of test
FAIL
exit status 1
FAIL    github.com/tlylt/learn-go/book  0.160s
```

## Result 2
```log
After TurnPageAtomic: page: 1
1
==================
WARNING: DATA RACE
Read at 0x00c0000a66a0 by goroutine 9:
  github.com/tlylt/learn-go/book.(*Book).SkipFirstPage()
      /Users/yong/Documents/GitHub/learn-go/book/book.go:53 +0x88
  github.com/tlylt/learn-go/book.TestRaceConditionBookWithAtomic.func1()
      /Users/yong/Documents/GitHub/learn-go/book/book_test.go:47 +0x84

Previous write at 0x00c0000a66a0 by goroutine 8:
  ??()
      -:0 +0x100a12ee8
  sync/atomic.AddInt32()
      <autogenerated>:1 +0x14
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1792 +0x180
  testing.(*T).Run.gowrap1()
      /usr/local/go/src/testing/testing.go:1851 +0x40

Goroutine 9 (running) created at:
  github.com/tlylt/learn-go/book.TestRaceConditionBookWithAtomic()
      /Users/yong/Documents/GitHub/learn-go/book/book_test.go:45 +0x168
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1792 +0x180
  testing.(*T).Run.gowrap1()
      /usr/local/go/src/testing/testing.go:1851 +0x40

Goroutine 8 (running) created at:
  testing.(*T).Run()
      /usr/local/go/src/testing/testing.go:1851 +0x684
  testing.runTests.func1()
      /usr/local/go/src/testing/testing.go:2279 +0x7c
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1792 +0x180
  testing.runTests()
      /usr/local/go/src/testing/testing.go:2277 +0x77c
  testing.(*M).Run()
      /usr/local/go/src/testing/testing.go:2142 +0xb68
  main.main()
      _testmain.go:51 +0x110
==================
After SkipFirstPage: page: 1
End of test: page: 1
--- FAIL: TestRaceConditionBookWithAtomic (0.00s)
    testing.go:1490: race detected during execution of test
FAIL
exit status 1
FAIL    github.com/tlylt/learn-go/book  0.159s
```

# TestRaceConditionSkipWithLock
```log
After TurnPageLock: page: 1
1
After SkipFirstLock: page: 1
End of test: page: 1
After TurnPageLock: page: 1
1
After SkipFirstLock: page: 1
End of test: page: 1
After TurnPageLock: page: 3
3
After SkipFirstLock: page: 3
End of test: page: 3
--- FAIL: TestRaceConditionSkipWithLock (0.00s)
    book_test.go:84: Expected page to be 1, Actual page is  3
After TurnPageLock: page: 1
1
After SkipFirstLock: page: 1
End of test: page: 1
After SkipFirstLock: page: 2
After TurnPageLock: page: 3
3
End of test: page: 3
--- FAIL: TestRaceConditionSkipWithLock (0.00s)
    book_test.go:84: Expected page to be 1, Actual page is  3
After SkipFirstLock: page: 2
After TurnPageLock: page: 3
3
End of test: page: 3
--- FAIL: TestRaceConditionSkipWithLock (0.00s)
    book_test.go:84: Expected page to be 1, Actual page is  3
After TurnPageLock: page: 1
1
After SkipFirstLock: page: 1
End of test: page: 1
After TurnPageLock: page: 1
1
After SkipFirstLock: page: 1
End of test: page: 1
After TurnPageLock: page: 1
1
After SkipFirstLock: page: 1
End of test: page: 1
After TurnPageLock: page: 1
1
After SkipFirstLock: page: 1
End of test: page: 1
FAIL
FAIL    github.com/tlylt/learn-go/book  0.160s
FAIL
```